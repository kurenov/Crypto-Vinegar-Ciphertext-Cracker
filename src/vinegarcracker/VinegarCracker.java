/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package vinegarcracker;

import java.util.Arrays;
import java.util.Stack;

/**
 *
 * @author Olzhas
 */
public class VinegarCracker {

  /**
   * @param args the command line arguments
   */
  public static void main(String[] args) {
    //Lincoln
//    String hex = "4D6B6D676A6D6C6476607677736B6B756A667360727666766B67706C6A716867716D6B4A676D707062697A656B654B6D606C606C624864736566687C72676F622864667667647567676C60636760656864636F65727867716D6B486E6F6D6B6E6B706552696B64546473767A686060666676646F666269606C6066766A67766B614C6D6E6A6A6A68714B6B7072676C62576472716176646C7765716874667772696771616D6471667673646665766A6C766C41696461776161756D776C60546C6A7060655177657164714B6B7072676C62576472716176646C776571687466776C6F4E6A6A666E6E6D74776E6F6C7060657062746C656F6C6060736C6A7E64756B6C6A6A67766B6160626D6D6B6878766B766A74656B66646F69707064736B656276606C677664686E716B646571416166607770616D646A62606A736B646D6B606E6F7D6466706661616F6D77706A73776D626A73637061666E6C677060736F6A6A466E6C6476607271626A61696B706B75716D706D71686D6D706A756A664960796B60656BE38290456864706A67646F556276726071766A756E7276686473636E6B6B664B6F686C6F6D6A77736E766676764D6B6D676A6D6C71617174706D6161756D507477686C64626C646E67656B65706677706C67676C6C727176676664717062706D6E627375736360706C62675161606F7666766C6F65736B6968766A6776686C3B316D64606667646C67626860606666766C6F60766D69656B6D637169676D617253677371676D6B60656B516371707C766A6A676D6963676576756377617268666669646B6D716D71786B6D4D696D6B6D6B6C724B6D736D686E6670646A6B6D63756070776D6B607166766C64716C626D68656B687C717761686C626B79616165676165716471746D71696A6A776A71726C6A606F76626A61736B75656945676E6B66736377577164726B616B40466C71626D6370486C6F616C686B72726C6F606E77776562606B6D7771756A66617D71636D776C6E6C6C62766D6375617778607670696E7177706D64575057606F63776177606166706A456D76636960714A6A49686C606B696F71666770736767706D6450667470636E6A67646F5262767178727161766866666A7168636F6A6A6C6B6D6571686D6D6576606F6C60607363776163736D6E6576766B6D6376756377615268766B7260737B6F6D71756E66777071726C7671686C776C60726E627260696D6F606C6F657070647567706B63756A66576A74766B6C607275667471756A664A6A73766B656B65756277606D6760706065727161766866666A71686C4B6D76646E666771686D6D74776E6F73706065716672606F716C71716967716A766D637561767563776176756D656B776C766B61466E6C65616164706270605276627060726D65456864706A67646367656B77646A6673647271746B776F6B6D706A6E64656D66644C6C676A6C72716B686871666B777367606B6B626B6F6D64756B6C6A726071656B706F667161626070676D6B66716F657364707A656B657166676072716A6B6B";
    //Education with spaces
    String hex = "4466766764756B6C6A25646C606B6871637077607222616B716922776C602176666566696B6D6325606C6724696463716A6C6F65236B6321696D6B726D676763602D2273766A71677124666E6C677166752E23656B6522776166696C6A67646D22606B68716777616B627B2D244C7522776C707222656B6674716677256E6C23706D6422607169756B756571686D6D246A6722706F6C6D6E702825757062606072226C762571706C626072716A6B6B722E23657621756668692163702468646C7765692D226E6B77606E232225606770706D64766A672565677561696E726E616B752C456B776C636F24606577606571686D6D24666E6C706D767571236B6321717A7771646F62706C62226A6A767570766771686D6D2825756762676D686C6424646F66237077606B6D6D6B6622617D2571706C626072716A6B6B606E23706060616B6177722C23506D687123676A6F716A777172226C6225756A66246471726F6D6660766A6B6B216D652475646662636A667B23656B6522776C6021666672606D6D7369606F76236B63216176767768617668642F566B6125736B646C7121766C24606577606571686D6D246C7222622463746C676568646C776569216A7669646F22716D6269762D2456686C606125303B363629214371706C626E662437216D652471696723626C7371772455736D776B666E6E23706A21766B61254477716B7564636D24466E6C75616B756B6C6A256E6C234C706C636D245768656B7076216D61686C66677024646D6E23776C666C62706A737B23746473766A617621766C2462746371656B7567662471696723766C666A7724716E226660706263776D6A6F2C23457121756C766965226F6173646E2F2471696723516B68766660254F63776D6A6F7124244C6F7666766B60766A6B6B606E23476A77676D656B75226C6A2544616C6A6A6C6B602825526D606D646D22626A6121417668717470626825536B646C7172226C6225303B35322566776276646F7666617621766B6D7621706A636D7522766A616470236D71722242767168616F612530312D4161746162706C6E6C626825727B7070606C71236577642266777160606F6D7669676724716E2273766A776B6761256466766764756B6C6A25606C67247173636A6A6C6F652F246A6776666A25676D712466696B6F6077646C23656B6522776C60217B6C716B662C234525627771766C62776F7168216666626C6F677024726963772476757767616B757123776D6E776F60256A6C6C732921776D6060737177656B6522626A612160662464636E6624716E22676B25607123706D6422716176746E77246A67226660706263776D6A6F2C234525756762676D686C642475736D656176726B6C6A2565676F6D7364707024716463606C6C6F6523736D68616B24606F6361686072226F6164736C6A6A622D22626A61216323777C72766669256E6423746A6D6B606D60722E23766066776F6571686D6D772921677B6568686C62706C6E6C7028257276717166757771617621636D602567776D606C6F6523616B60606F617621766665666967717725756D23706060616B24716E22776C602160667771216D65247169676A762560606A686C756B66772B21516C6960756B6E6176216767716660766A6B6B606E23777C72766669762161626A256367237176646623706A2172716B686E766624616E6177766C6F6770246A73226A6060606E70246472227461696D226277256A6C6C7369646664612921756B6D6669226A77256A6C6C736B21637024766E616A656921676D636C6F6766766C6F652D2451696B702466606C236860606623706A21726C686C756B606569216361717664226C6225756A66247678717761682D22736577756B60716960706F7D25686C23706A75636F6D7160706A656B2171776571647123656B6522646B7364706D69606F762D5477686F62767C212A6C7625646E6669606F7662767C28226660706263776D6A6F22606B6B726B707076216D652471696723626C737177247C64637177256E6423626A736F6268292171777670627676766065226660706263776D6A6F2C234D6B2165666A6073636F282571706A6964737B236161746162706C6E6C23676A6F716A777172226C6225726B7B246A7322706173646C237D60607070246A672270676D6E6D6F6D6B662270706473766A6A622163772471696723656264226C622534226C7625372E236569756A6C71626922776C6C7222756577686770246764767461606F2E23656B6522706B6864766A69607222746D71696B6D2825626D766A71736B66772B21456F6B67606E6F7D292163716B706F6623333524226C622571706A6964737B2E65626422606C6C6D6671616B2163716125646C716B696D6767246C6F2273766C6C63717D256466766764756B6C6A2921636D6025756A6A772571706C746A73766A6B6B216B70247768716A6A622F4B6D24686E717724666E6C776168716D71657778226660706263776D6A6F636F2476787177616872226C6225756A6624726E706F6029217166676A6F6662767C216767716660766A6B6B21616C6A7668717777256E6423706D64227061666E6C67247C64637177256E6423626A736F6268256466766764756B6C6A25756A6270256E61607177216676766C6F652365616E6E667766646C60612B4876236D7621616B657760617761776878666025637B237077606C706D71686D6D2463736D6E2471696723707C716B6065696D7B23676A6C727668766E707A2825626D6E7477646A666A766874662475736B6E657778226660706263776D6A6F22656B77216F6A6A6A73712F24716E22776C60216D73706C6E6C626829217166686062766A726021766676716863717D292120736B76752F7061666E6C67657778202F246A7322216C6C666A667627216767716660766A6B6B212A662A622F2E23716B687466767668767A2825776D606571686D6D65692171606C6A6E6E2A24636E70236561746E77772B496B646C6073226660706263776D6A6F2E236569726D2367646D6E666025756771706C60707A2825756A6A76612171776562642E236B7721726C7771217166676A6F6662767C216767716660766A6B6B2D226A7725756A66246B6E6C2E676A6C727668766E707A24606577606571686D6D6569216E6672606D22776C647522656B696D6D747725756A6624666E6F736860756B6C6A256E6423652572616B6B6A6D2273766A776B676D6B662262247664616C6A6160707A24606577606571686D6D28257277606C256071236525696B646C2572616B6B6A6D226C76257267606B6B6563717D2572616B6B6A6D2C23506073766A657778226660706263776D6A6F226A77256F6D7169646D6E7A24716069666A25756D236D6B626E76606021776D606073657165617463776125606C6724756E71776377606676657164226660706263776D6A6F2E236576217566686921637024736E6162706C6E6C6268256466766764756B6C6A25606C67247173636A6A6C6F652D24466E6E6F6162647123656B6522766A6C776771776C756B66772560706624716967236964686C236D6B72766A7070756B6C6A7621766B65712172716B7368666624716470776D64737B236161746162706C6E6C2D24466E6E6F6166756B756169782E23706D6471662464736723776A6C67776D686471236F6B6E756D24647222776177756B62767C216B6D7771687676706C6E6C702A25556771706C60707A24606577606571686D6D2462646C6676646D6E7A2477647176687172226A6A25756A6624776461666D7575226C6225626771706C676B60657164712F246168726F6B6860712F246A732262676465676E6D6621666663776467702A";
    //Education no spaces
    //String hex = "4466766764756B6C6A606F616C69756071706176636D776C716967776164626A6A6A62606C67686060706D6D6B666D656F6B6E756F616166672F74776E726676666E6C677166752E626A617567606C6B68616268666E6F736171646C607D2B4876776C7072646C67707267706B6B756A6667706D766A7264756B6C6A6A6771686D696D712F7077606666776A7372716B636471706D6A6F712F657676676F6864726F666A71606E2F696A73636F22646471776C60756B60606077676F6B756C676D702B476D7169646D6767716660766A6B6B626D6D776C7276706B63727B7070606C63776D66686C7070777461776D6A6F2E776164626A6A6A62606C677077606B6D6D6B66607A74776E64667776686D6D6569756762676D6470702A51696B70676A6F716A7771726D65706D6463737469686162706C6E6C6C6275646662636A667B626A61756A66606077676F6B756C676D706A676176767768617668642F566B617768656B70716E6767716660766A6B6B68716262706F666269606F7662686D746F626A7768656B702B526B6D6760303B3636294070776D666D67316B63756A66626C73717754776E766C676A6D766C706D644776766A7167626A466E6C75616B756B6C6A6A6F4A7669646F506A636D75716C666968656677646D6E706D626F63776B777872627671686770706A66776276646F766661716967716D626976776B606577606571686D6D2A4475756C7669656E6672606D2E776C60546C6A7060654C62706C6E6C70234C6F7666766B60766A6B6B606E406B73646C626A716E6C46676A6F6D6E6D662D516C676C606E626A6142776F707073636F566C666A77776A67333A323366776276646F76666176756A6A777768656B70706F6666766C757142767168616F6134322C4660706263776D6A6F636F777C72766669766070666176756361686C726A6660716E72716B736866666161746162706C6E6C626A617570626D6B686C64286A6776666A636E70606C6C6D6671616B606C67706D647B6C716B662C42677073706A67706D776E6060676B6D6176766A627076757767616B7571706C6A746E676F6B6E752F716B6567717771606C67656B65606665676D67776B616E6370706D64706677706D766C62606577606571686D6D2A44756762676D686C6474776E64667776686D6D60606D6B7561777276666566696B6D6372696B606C606F63616860726E6665776F6B6D6329606C67657678717761686E64736B6968616A61762D706663706D63776D6A6F712F617D606F6A6A64756B6C6A762D71777670627676766072636D6063746C676D6B66676D65676D6770706060616B617772766C706060616B706A756A66666072766C627169676A7664636B6F6D716867702A566E6F66706C6C67706161746162706C6E6C62687678717761687261626A676477706161756D73766A6C6D7761616E6177766C6F67706B77686666656972637073606D6E62776E6F6D7468606565662872696B606C6C72696D6B726F6370776A626B6268606F656A6A6064706A6A622F566B6D7662636D68606066776B756E6E6A706C62636F65677471666B63756A66777C7276666929716371706C62776F65776D7B6A6A716E7662686C7563716D646F717765716471626A61666D7561776F6F666A712F52716D6860707A2C6A73676F6168646C776577782B6660706263776D6A6F616C6A76687177776A67766B6163687070707C646371776A67646C7668606E2F777173776070707367676161746162706C6E6C2D4D6B66676D6177606E2F7477686F62767C6466766764756B6C6A666E6C706D7675716C6276687A6C76766474666A7C646371776A6771606C6A6E6E6A6A627276627671686C646571756A666562646D65316A73342F6569756A6C716269766B6D767763716D60726066707264676D28646F66706B6864766A696072756A706D686C2F676A746C77766C64712D43696E60626869782E62766A746C673335246D657477686F62767C2C63646166696B6F6077646C627660646C716B696D67676D6B71706A6964737B6660706263776D6A6F2E626A61756A6A7775736D736B77756B6C6A6C72706A776C6F652D4D6B6C6D7070666E6C776168716D716577786767716660766A6B6B606E707D7675676E776A67766B61726E706F60297267606B6B6563717D606577606571686D6D676A6F716A7771726D65706D647166676A6F667A616473716C62636E706E65696466766764756B6C6A716963776B666277716070736B6D6364656D6F617662676D67602F4B776D76626A627664627666766C7B6767667C7570626A7668766A6B6B67706C69716967777D75686162686978616C6975746E706B77782E606B687170666C606F716A726071706A6964737B6660706263776D6A6F646C7668686C6C76762D766C706D646D73706C6E6C62682972676F6166756B7561716470776D64737B2F26756E7177297664616C6A6160707A26296E70216C6C666A6676276466766764756B6C6A2D642C642A29746C6A726073716A707C2D746C6764756B6C6A646D71606C6A6E6E2A626A736367716975712D4C6C666A6676606577606571686D6D28646D716C67646D6E6660716470776D64737B2F706D6870677771606566286A73726C77717267606B6B6563717D606577606571686D6D286C72766B616B6E6C2E676A6C727668766E707A6161746162706C6E6C6268696474666871696377626A6D6E6C7376756A66676A6C726F6171686D6D6B636071606C6A6E6E73766A776B676D6B66637061666E6C676577786767716660766A6B6B2D7176676D6071626C6C666A70676D6E6D6F6B777267606B6B6563717D76626A6C6B692F566676716863717D606577606571686D6D6D766F6D7169646D6E7A70646A676D706A686C6068706567766A6164706476646577627060606C67746A727664766465776270606466766764756B6C6A2960717461696D6370726A6263776D6A6F636F6161746162706C6E6C626A617570626D6B686C642A466E6E6F61626471626A61746C6A726073716A706C6471627660756A666964686C6A6A76756B777171686D6D777169637774776E746A6060756771706C60707A6161746162706C6E6C2D476A6D6E666771687466687C2D766B617664637161766E6F66706C6C67706F6B6E756D6576756771706C60707A6D6B72766A7070756B6C6A762F566676716863717D606577606571686D6D63606F677165696D7B716176746E77776C6F766B61776461666D75756D65676073766A626C62637761762D666A74696E6F6277296E7062676465676E6D66656764766064712D";
    //Instructor Cipher
//    String hex = "F96DE8C227A259C87EE1DA2AED57C93FE5DA36ED4EC87EF2C63AAE5B9A7EFFD673BE4ACF7BE8923CAB1ECE7AF2DA3DA44FCF7AE29235A24C963FF0DF3CA3599A70E5DA36BF1ECE77F8DC34BE129A6CF4D126BF5B9A7CFEDF3EB850D37CF0C63AA2509A76FF9227A55B9A6FE3D720A850D97AB1DD35ED5FCE6BF0D138A84CC931B1F121B44ECE70F6C032BD56C33FF9D320ED5CDF7AFF9226BE5BDE3FF7DD21ED56CF71F5C036A94D963FF8D473A351CE3FE5DA3CB84DDB71F5C17FED51DC3FE8D732BF4D963FF3C727ED4AC87EF5DB27A451D47EFD9230BF47CA6BFEC12ABE4ADF72E29224A84CDF3FF5D720A459D47AF59232A35A9A7AE7D33FB85FCE7AF5923AA31EDB3FF7D33ABF52C33FF0D673A551D93FFCD33DA35BC831B1F43CBF1EDF67F0DF23A15B963FE5DA36ED68D378F4DC36BF5B9A7AFFD121B44ECE76FEDC73BE5DD27AFCD773BA5FC93FE5DA3CB859D26BB1C63CED5CDF3FE2D730B84CDF3FF7DD21ED5ADF7CF0D636BE1EDB79E5D721ED57CE3FE6D320ED57D469F4DC27A85A963FF3C727ED49DF3FFFDD24ED55D470E69E73AC50DE3FE5DA3ABE1EDF67F4C030A44DDF3FF5D73EA250C96BE3D327A84D963FE5DA32B91ED36BB1D132A31ED87AB1D021A255DF71B1C436BF479A7AF0C13AA14794";
    int[] freq = new int[256];
    int length = hex.length() / 2;
    int[] ctext = new int[length];
    int keyLength = 5;
    int minKeyLength = 1;
    int maxKeyLength = 470;
    double qSum = 0.065;
    double minDifference = 1;
    int minDifferenceIndex = 0;
    double treshold = 0.005;

    //from HEX to DEC
    for (int i = 0; i < length; i++) {
      int j = i * 2;
      int x = Integer.decode("0x" + hex.substring(j, j + 2));
      ctext[i] = x;
      System.out.print(x + " ");
    }
    System.out.println();
    //KEY LENGTH SEARCHING
    for (int i = minKeyLength; i <= maxKeyLength; i++) {
      int k = 0;
      double counter = 0;
      while (k < length) {
        freq[ctext[k]]++;
        k += i;
        counter++;
      }

      double sum = 0;
      double normFreq = 0;
      for (int m = 0; m < freq.length; m++) {
        normFreq = (double) (freq[m] / counter);
        sum = sum + normFreq * normFreq;
      }

      if (Math.abs(qSum - sum) < minDifference) {
        minDifference = Math.abs(qSum - sum);
        minDifferenceIndex = i;
      }
      if (Math.abs(qSum - sum) <= treshold) {
        System.out.println("Possible Key Length: " + i + " - " + Math.abs(qSum - sum));
      }
//      System.out.println(i+": "+sum);
      for (int m = 0; m < freq.length; m++) {
        freq[m] = 0;
      }
    }
    System.out.println("Estimated Key Length: " + minDifferenceIndex);
    keyLength = 5;

    //Key Searching
    int key[] = new int[keyLength];
    for (int i = 0; i < keyLength; i++) {
      int k = i;
      int max = 0;
      Stack maxStack = new Stack();
      Stack maxIndexStack = new Stack();
      int maxIndex = 0;
      while (k < length) {
        int x = ctext[k];
        freq[x]++;
        if (freq[x] > max && maxIndex!=x && x>32 && x<127) {
          max = freq[x];
          maxStack.push(max);
          maxIndex = x;
          maxIndexStack.push(Math.abs(maxIndex - 101));
        }
        k += keyLength;
      }
      key[i] = Math.abs(maxIndex - 101);
      System.out.println(i+": "+maxIndex + "-\t (" + max + ") \t" + key[i]);
      System.out.println(Arrays.toString(maxIndexStack.toArray()));
      for (int m = 0; m < freq.length; m++) {
        freq[m] = 0;
      }
    }
    key[0]=4;
    key[1]=1;
    key[2]=2;
    key[3]=25;
//    key[4]=62;
//    key[5]=61;
//    key[6]=12;
//    
//    key[8]=25;
//    key[9]=124;
    for (int i = 0; i < length; i++) {
      int currentKey = key[i % keyLength];
      int x = ctext[i] ^ currentKey;
      String s = Character.toString((char) (x));
      System.out.print(s);
    }

  }
}
